<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1100" font-family="Segoe UI, Arial, sans-serif">
  <defs>
    <linearGradient id="corpZoneGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#7b1fa2;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#4a148c;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="innerDmzGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#e65100;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#bf360c;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="coreZoneGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#2e7d32;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1b5e20;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="consoleGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#1976d2;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#0d47a1;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="portalGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#00796b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#004d40;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="openamGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ff5722;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#e64a19;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="gatewayGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#c62828;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#b71c1c;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="dataGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#455a64;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#263238;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="3" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
    <marker id="arrowPurple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#7b1fa2"/>
    </marker>
    <marker id="arrowOrange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#e65100"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2e7d32"/>
    </marker>
    <marker id="arrowBlue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#1976d2"/>
    </marker>
    <marker id="arrowRed" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#c62828"/>
    </marker>
    <marker id="arrowTeal" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#00796b"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="1400" height="1100" fill="#eceff1"/>
  
  <!-- Title -->
  <text x="700" y="35" text-anchor="middle" font-size="26" font-weight="bold" fill="#263238">User Interaction &amp; Authentication Flows</text>
  <text x="700" y="58" text-anchor="middle" font-size="14" fill="#546e7a">Corporate User (Console) " App Developer (Portal) " API Consumer (OAuth 2.0)</text>
  
  <!-- ==================== CORPORATE ZONE ==================== -->
  <g filter="url(#shadow)">
    <rect x="30" y="80" width="1340" height="140" rx="10" fill="url(#corpZoneGrad)"/>
  </g>
  <text x="50" y="105" font-size="16" font-weight="bold" fill="#fff">CORPORATE ZONE</text>
  <text x="50" y="122" font-size="11" fill="rgba(255,255,255,0.8)">Internal Users &amp; Applications</text>
  
  <!-- Corporate User -->
  <rect x="60" y="135" width="180" height="70" rx="6" fill="#fff" stroke="#7b1fa2" stroke-width="2"/>
  <text x="150" y="160" text-anchor="middle" font-size="20">=d</text>
  <text x="150" y="180" text-anchor="middle" font-size="11" font-weight="bold" fill="#4a148c">Corporate User</text>
  <text x="150" y="195" text-anchor="middle" font-size="9" fill="#666">(API Admin / Platform Team)</text>
  
  <!-- App Developer -->
  <rect x="280" y="135" width="180" height="70" rx="6" fill="#fff" stroke="#00796b" stroke-width="2"/>
  <text x="370" y="160" text-anchor="middle" font-size="20">=h=»</text>
  <text x="370" y="180" text-anchor="middle" font-size="11" font-weight="bold" fill="#004d40">Application Developer</text>
  <text x="370" y="195" text-anchor="middle" font-size="9" fill="#666">(API Consumer / Builder)</text>
  
  <!-- API Consumer Application -->
  <rect x="500" y="135" width="200" height="70" rx="6" fill="#fff" stroke="#c62828" stroke-width="2"/>
  <text x="600" y="160" text-anchor="middle" font-size="20">=ñ</text>
  <text x="600" y="180" text-anchor="middle" font-size="11" font-weight="bold" fill="#b71c1c">API Consumer App</text>
  <text x="600" y="195" text-anchor="middle" font-size="9" fill="#666">(Internal Microservice)</text>
  
  <!-- Internal App B -->
  <rect x="740" y="135" width="180" height="70" rx="6" fill="#fff" stroke="#c62828" stroke-width="2"/>
  <text x="830" y="160" text-anchor="middle" font-size="20">=¥</text>
  <text x="830" y="180" text-anchor="middle" font-size="11" font-weight="bold" fill="#b71c1c">Internal App B</text>
  <text x="830" y="195" text-anchor="middle" font-size="9" fill="#666">(Order Service)</text>
  
  <!-- Backend Service -->
  <rect x="960" y="135" width="180" height="70" rx="6" fill="#fff" stroke="#37474f" stroke-width="2"/>
  <text x="1050" y="160" text-anchor="middle" font-size="20">='</text>
  <text x="1050" y="180" text-anchor="middle" font-size="11" font-weight="bold" fill="#263238">Backend API</text>
  <text x="1050" y="195" text-anchor="middle" font-size="9" fill="#666">(User Service)</text>
  
  <!-- Flow Labels at Top -->
  <rect x="1180" y="90" width="170" height="110" rx="6" fill="rgba(255,255,255,0.15)"/>
  <text x="1265" y="115" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">USER TYPES</text>
  <text x="1190" y="138" font-size="10" fill="#fff">=d Console Admin</text>
  <text x="1190" y="158" font-size="10" fill="#fff">=h=» App Developer</text>
  <text x="1190" y="178" font-size="10" fill="#fff">=ñ API Consumer</text>
  
  <!-- ==================== INNER DMZ ==================== -->
  <g filter="url(#shadow)">
    <rect x="30" y="240" width="1340" height="130" rx="10" fill="url(#innerDmzGrad)"/>
  </g>
  <text x="50" y="265" font-size="16" font-weight="bold" fill="#fff">INNER DMZ</text>
  <text x="50" y="282" font-size="11" fill="rgba(255,255,255,0.8)">Authentication &amp; Identity Services</text>
  
  <!-- OpenAM SSO -->
  <rect x="400" y="295" width="600" height="60" rx="8" fill="url(#openamGrad)" filter="url(#shadow)"/>
  <text x="700" y="320" text-anchor="middle" font-size="14" font-weight="bold" fill="#fff">= OpenAM SSO Server (OAuth 2.0 / OIDC Provider)</text>
  <text x="700" y="342" text-anchor="middle" font-size="10" fill="rgba(255,255,255,0.9)">/oauth2/authorize " /oauth2/token " /oauth2/introspect " /oauth2/jwks " Connected to LDAP/AD</text>
  
  <!-- ==================== CORE ZONE ==================== -->
  <g filter="url(#shadow)">
    <rect x="30" y="390" width="1340" height="350" rx="10" fill="url(#coreZoneGrad)"/>
  </g>
  <text x="50" y="420" font-size="16" font-weight="bold" fill="#fff">CORE ZONE</text>
  <text x="50" y="437" font-size="11" fill="rgba(255,255,255,0.8)">Gravitee Platform &amp; Data Services</text>
  
  <!-- Console UI -->
  <rect x="60" y="455" width="200" height="90" rx="8" fill="url(#consoleGrad)" filter="url(#shadow)"/>
  <text x="160" y="485" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff">=» Console UI</text>
  <text x="160" y="505" text-anchor="middle" font-size="10" fill="rgba(255,255,255,0.9)">API Lifecycle Management</text>
  <text x="160" y="525" text-anchor="middle" font-size="9" fill="rgba(255,255,255,0.7)">console.internal.company.com</text>
  
  <!-- Developer Portal -->
  <rect x="290" y="455" width="200" height="90" rx="8" fill="url(#portalGrad)" filter="url(#shadow)"/>
  <text x="390" y="485" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff">=Ú Developer Portal</text>
  <text x="390" y="505" text-anchor="middle" font-size="10" fill="rgba(255,255,255,0.9)">API Documentation &amp; Subscribe</text>
  <text x="390" y="525" text-anchor="middle" font-size="9" fill="rgba(255,255,255,0.7)">portal.internal.company.com</text>
  
  <!-- Management API -->
  <rect x="520" y="455" width="180" height="90" rx="8" fill="#1a237e" filter="url(#shadow)"/>
  <text x="610" y="485" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff">=Ê Management API</text>
  <text x="610" y="505" text-anchor="middle" font-size="10" fill="rgba(255,255,255,0.9)">API Configuration</text>
  <text x="610" y="525" text-anchor="middle" font-size="9" fill="rgba(255,255,255,0.7)">:8083</text>
  
  <!-- API Gateway -->
  <rect x="730" y="455" width="220" height="90" rx="8" fill="url(#gatewayGrad)" filter="url(#shadow)"/>
  <text x="840" y="485" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff">¡ API Gateway</text>
  <text x="840" y="505" text-anchor="middle" font-size="10" fill="rgba(255,255,255,0.9)">Internal API Traffic (2 Nodes)</text>
  <text x="840" y="525" text-anchor="middle" font-size="9" fill="rgba(255,255,255,0.7)">gravitee-gateway:8082</text>
  
  <!-- Backend APIs -->
  <rect x="980" y="455" width="180" height="90" rx="8" fill="#37474f" filter="url(#shadow)"/>
  <text x="1070" y="485" text-anchor="middle" font-size="13" font-weight="bold" fill="#fff">=' Backend APIs</text>
  <text x="1070" y="505" text-anchor="middle" font-size="10" fill="rgba(255,255,255,0.9)">Microservices</text>
  <text x="1070" y="525" text-anchor="middle" font-size="9" fill="rgba(255,255,255,0.7)">user-svc, order-svc, etc.</text>
  
  <!-- Data Services -->
  <rect x="60" y="570" width="1100" height="80" rx="8" fill="rgba(255,255,255,0.15)"/>
  <text x="610" y="595" text-anchor="middle" font-size="12" font-weight="bold" fill="#fff">DATA SERVICES</text>
  
  <rect x="80" y="610" width="150" height="35" rx="4" fill="#4db33d"/>
  <text x="155" y="632" text-anchor="middle" font-size="10" font-weight="bold" fill="#fff">=Ä MongoDB</text>
  
  <rect x="250" y="610" width="150" height="35" rx="4" fill="#dc382d"/>
  <text x="325" y="632" text-anchor="middle" font-size="10" font-weight="bold" fill="#fff">¡ Redis</text>
  
  <rect x="420" y="610" width="180" height="35" rx="4" fill="#f9b110"/>
  <text x="510" y="632" text-anchor="middle" font-size="10" font-weight="bold" fill="#000">=È Elasticsearch</text>
  
  <rect x="620" y="610" width="150" height="35" rx="4" fill="#2c3e50"/>
  <text x="695" y="632" text-anchor="middle" font-size="10" font-weight="bold" fill="#fff">=Á LDAP/AD</text>
  
  <!-- ==================== FLOW ARROWS ==================== -->
  
  <!-- FLOW A: Corporate User ’ Console UI (via OpenAM Auth) -->
  <path d="M 150 205 L 150 290" stroke="#7b1fa2" stroke-width="3" fill="none" marker-end="url(#arrowPurple)" stroke-dasharray="8,4"/>
  <circle cx="150" cy="247" r="14" fill="#7b1fa2"/>
  <text x="150" y="252" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">A1</text>
  
  <path d="M 150 355 L 150 455" stroke="#7b1fa2" stroke-width="3" fill="none" marker-end="url(#arrowPurple)"/>
  <circle cx="150" cy="405" r="14" fill="#7b1fa2"/>
  <text x="150" y="410" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">A2</text>
  
  <!-- Auth redirect line from Console to OpenAM -->
  <path d="M 260 490 L 340 490 L 340 340 L 400 340" stroke="#ff5722" stroke-width="2" fill="none" marker-end="url(#arrowOrange)" stroke-dasharray="5,3"/>
  
  <!-- FLOW B: App Developer ’ Portal (via OpenAM Auth) -->
  <path d="M 370 205 L 370 290" stroke="#00796b" stroke-width="3" fill="none" marker-end="url(#arrowTeal)" stroke-dasharray="8,4"/>
  <circle cx="370" cy="247" r="14" fill="#00796b"/>
  <text x="370" y="252" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">B1</text>
  
  <path d="M 370 355 L 370 455" stroke="#00796b" stroke-width="3" fill="none" marker-end="url(#arrowTeal)"/>
  <circle cx="370" cy="405" r="14" fill="#00796b"/>
  <text x="370" y="410" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">B2</text>
  
  <!-- Auth redirect line from Portal to OpenAM -->
  <path d="M 490 490 L 520 490 L 520 355 L 580 355" stroke="#ff5722" stroke-width="2" fill="none" marker-end="url(#arrowOrange)" stroke-dasharray="5,3"/>
  
  <!-- FLOW C: API Consumer ’ Gateway ’ Backend (OAuth 2.0) -->
  <path d="M 600 205 L 600 290" stroke="#c62828" stroke-width="3" fill="none" marker-end="url(#arrowRed)" stroke-dasharray="8,4"/>
  <circle cx="600" cy="247" r="14" fill="#c62828"/>
  <text x="600" y="252" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">C1</text>
  
  <path d="M 660 325 L 660 380 L 840 380 L 840 455" stroke="#c62828" stroke-width="3" fill="none" marker-end="url(#arrowRed)"/>
  <circle cx="750" cy="380" r="14" fill="#c62828"/>
  <text x="750" y="385" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">C2</text>
  
  <!-- Gateway to OpenAM (token validation) -->
  <path d="M 840 455 L 840 415 L 760 415 L 760 355" stroke="#ff5722" stroke-width="2" fill="none" marker-end="url(#arrowOrange)" stroke-dasharray="5,3"/>
  <circle cx="800" cy="415" r="12" fill="#ff5722"/>
  <text x="800" y="419" text-anchor="middle" font-size="9" font-weight="bold" fill="#fff">C3</text>
  
  <!-- Gateway to Backend -->
  <path d="M 950 500 L 980 500" stroke="#37474f" stroke-width="3" fill="none" marker-end="url(#arrowGreen)"/>
  <circle cx="965" cy="500" r="12" fill="#2e7d32"/>
  <text x="965" y="504" text-anchor="middle" font-size="9" font-weight="bold" fill="#fff">C4</text>
  
  <!-- Internal App to Gateway -->
  <path d="M 830 205 L 830 290" stroke="#c62828" stroke-width="2" fill="none" marker-end="url(#arrowRed)" stroke-dasharray="6,3"/>
  <path d="M 800 355 L 800 380 L 860 380 L 860 455" stroke="#c62828" stroke-width="2" fill="none" marker-end="url(#arrowRed)"/>
  
  <!-- Console to Mgmt API -->
  <path d="M 260 500 L 520 500" stroke="#1976d2" stroke-width="2" fill="none" marker-end="url(#arrowBlue)"/>
  
  <!-- Portal to Mgmt API -->
  <path d="M 490 500 L 520 500" stroke="#00796b" stroke-width="2" fill="none" marker-end="url(#arrowTeal)"/>
  
  <!-- ==================== FLOW LEGEND ==================== -->
  <rect x="30" y="760" width="1340" height="320" rx="10" fill="#fff" filter="url(#shadow)"/>
  <text x="700" y="790" text-anchor="middle" font-size="18" font-weight="bold" fill="#263238">Flow Details</text>
  
  <!-- Flow A Details -->
  <rect x="50" y="810" width="420" height="130" rx="6" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2"/>
  <text x="260" y="835" text-anchor="middle" font-size="13" font-weight="bold" fill="#4a148c">FLOW A: Corporate User ’ Console UI</text>
  <text x="60" y="860" font-size="10" fill="#333">A1. Corporate User accesses console.internal.company.com</text>
  <text x="60" y="878" font-size="10" fill="#333">     ’ Console redirects to OpenAM (/oauth2/authorize)</text>
  <text x="60" y="896" font-size="10" fill="#333">     ’ User authenticates with corporate credentials (LDAP)</text>
  <text x="60" y="914" font-size="10" fill="#333">     ’ OpenAM returns authorization code</text>
  <text x="60" y="932" font-size="10" fill="#333">A2. Console exchanges code for JWT token, user logged in</text>
  
  <!-- Flow B Details -->
  <rect x="490" y="810" width="420" height="130" rx="6" fill="#e0f2f1" stroke="#00796b" stroke-width="2"/>
  <text x="700" y="835" text-anchor="middle" font-size="13" font-weight="bold" fill="#004d40">FLOW B: App Developer ’ Portal</text>
  <text x="500" y="860" font-size="10" fill="#333">B1. Developer accesses portal.internal.company.com</text>
  <text x="500" y="878" font-size="10" fill="#333">     ’ Portal redirects to OpenAM for authentication</text>
  <text x="500" y="896" font-size="10" fill="#333">     ’ User logs in with corporate credentials</text>
  <text x="500" y="914" font-size="10" fill="#333">     ’ OpenAM issues JWT token</text>
  <text x="500" y="932" font-size="10" fill="#333">B2. Developer views API docs, subscribes, gets API keys</text>
  
  <!-- Flow C Details -->
  <rect x="930" y="810" width="420" height="130" rx="6" fill="#ffebee" stroke="#c62828" stroke-width="2"/>
  <text x="1140" y="835" text-anchor="middle" font-size="13" font-weight="bold" fill="#b71c1c">FLOW C: API Consumer (OAuth 2.0)</text>
  <text x="940" y="860" font-size="10" fill="#333">C1. App requests access token from OpenAM</text>
  <text x="940" y="878" font-size="10" fill="#333">     ’ POST /oauth2/token (client_credentials grant)</text>
  <text x="940" y="896" font-size="10" fill="#333">C2. App calls API Gateway with Bearer token</text>
  <text x="940" y="914" font-size="10" fill="#333">C3. Gateway validates token via /oauth2/introspect or JWKS</text>
  <text x="940" y="932" font-size="10" fill="#333">C4. Gateway routes to Backend, returns response</text>
  
  <!-- OAuth 2.0 Token Info -->
  <rect x="50" y="955" width="640" height="110" rx="6" fill="#fff3e0" stroke="#ff5722" stroke-width="2"/>
  <text x="370" y="980" text-anchor="middle" font-size="13" font-weight="bold" fill="#e65100">OpenAM OAuth 2.0 Endpoints (Inner DMZ)</text>
  <text x="60" y="1005" font-size="10" fill="#333" font-family="monospace">/oauth2/authorize   - Authorization endpoint (user login)</text>
  <text x="60" y="1023" font-size="10" fill="#333" font-family="monospace">/oauth2/token       - Token endpoint (get access/refresh tokens)</text>
  <text x="60" y="1041" font-size="10" fill="#333" font-family="monospace">/oauth2/introspect  - Token introspection (validate tokens)</text>
  <text x="60" y="1059" font-size="10" fill="#333" font-family="monospace">/oauth2/jwks        - JSON Web Key Set (for JWT validation)</text>
  
  <!-- JWT Token Structure -->
  <rect x="710" y="955" width="640" height="110" rx="6" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2"/>
  <text x="1030" y="980" text-anchor="middle" font-size="13" font-weight="bold" fill="#1b5e20">JWT Token Claims</text>
  <text x="720" y="1005" font-size="10" fill="#333" font-family="monospace">sub: "user@company.com" or "client_id"</text>
  <text x="720" y="1023" font-size="10" fill="#333" font-family="monospace">iss: "https://sso.inner-dmz.company.com/openam"</text>
  <text x="720" y="1041" font-size="10" fill="#333" font-family="monospace">aud: "gravitee-gateway" | roles: ["API_USER", "SERVICE"]</text>
  <text x="720" y="1059" font-size="10" fill="#333" font-family="monospace">exp: 1739462400 | scope: "read write api:access"</text>
</svg>
